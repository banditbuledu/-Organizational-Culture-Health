import streamlit as st
from google import genai
import plotly.graph_objects as go

# 1. API μ„¤μ •
GOOGLE_API_KEY = st.secrets["AIzaSyDIsaCfkHxzKVA3Y0F693NOm0tFqBN"]
client = genai.Client(api_key=AIzaSyDIsaCfkHxzKVA3Y0F693NOm0tFqBN)

# 2. μ§„λ‹¨ μ „λ¬Έκ°€ νλ¥΄μ†λ‚ (μ‚¬μ©μλ‹μ ν•µμ‹¬ λ΅μ§)
SYSTEM_PROMPT = """
λ‹Ήμ‹ μ€ 'μ΅°μ§λ¬Έν™” κ±΄κ°•λ„ μ§„λ‹¨' μ „λ¬Έκ°€μ…λ‹λ‹¤. 
μ‚¬μ©μκ°€ μ…λ ¥ν• 20κ° λ¬Έν•­μ μ μμ™€ 4κ° μμ—­λ³„ ν‰κ·  μ μλ¥Ό λ°”νƒ•μΌλ΅ μ‹¬μΈµ μ§„λ‹¨μ„ λ‚΄λ¦½λ‹λ‹¤.
μμ—­: μ‹¬λ¦¬μ  μ•μ „κ°, ν–‰μ • ν¨μ¨μ„±, λ¦¬λ”μ‹­, μ •μ„μ  μΈμ •
μ§„λ‹¨ μ‹ ν¬ν•¨ν•  λ‚΄μ©:
- ν„μ¬ μ°λ¦¬ ν€μ μ΅°μ§λ¬Έν™” κ±΄κ°•λ„ μ΄ν‰
- κ°€μ¥ λ†’μ€ μ μ μμ—­μ κ°•μ  κ°•ν™” λ°©μ•
- κ°€μ¥ λ‚®μ€ μ μ μμ—­μ κµ¬μ²΄μ μΈ κ°μ„  μ•΅μ… ν”λ 3κ°€μ§€
- ν€μ›λ“¤μ΄ λ°”λ΅ μ‹¤μ²ν•  μ μλ” λ”°λ»ν• ν•λ§λ””
"""

st.set_page_config(page_title="μ΅°μ§λ¬Έν™” κ±΄κ°•λ„ μ§„λ‹¨", layout="wide")

# μ‚¬μ΄λ“λ°”: ν€ μ„ νƒ
st.sidebar.title("πΆ μ§„λ‹¨ μ„¤μ •")
team_name = st.sidebar.selectbox("μ†μ† ν€μ„ μ„ νƒν•μ„Έμ”", ["λ§μΌ€ν…ν€", "κ°λ°ν€", "λ””μμΈν€", "ν–‰μ •ν€", "κΈ°νν€"])
st.sidebar.divider()
st.sidebar.info(f"ν„μ¬ **[{team_name}]** μ§„λ‹¨ λ¨λ“μ…λ‹λ‹¤.")

st.title("π€ μ΅°μ§λ¬Έν™” κ±΄κ°•λ„ μ§„λ‹¨ μ„λΉ„μ¤")
st.markdown("---")

# 3. 20κ° μ§„λ‹¨ λ¬Έν•­ κµ¬μ„±
questions = [
    "[μ‹¤μ ν¬μ©] μ—…λ¬΄ μ¤‘ μ°©μ¤λ‚ μ‹¤μκ°€ λ°μƒν–μ„ λ• λΉ„λ‚λ³΄λ‹¤ μ‹μ¤ν… κ°μ„ μ— μ΄μ μ„ λ§μ¶λ‹¤.",
    "[μ΄κ²¬ κ°μ§„] κ΄€λ¦¬μμ—κ² λ¶λ…ν™•ν• μ§€μ‹λ‚ κ΄€ν–‰μ— λ€ν•΄ μμ λ΅­κ² μκ²¬μ„ λ‚Ό μ μλ‹¤.",
    "[κ°λ“± ν•΄κ²°] λ¶€μ„ λ‚΄ κ°λ“± λ°μƒ μ‹ ν¬λ…ν•κ² λ…Όμν•κ³  μ΅°μ •ν•λ‹¤.",
    "[μƒνΈ μ΅΄μ¤‘] μ§κΈ‰, μ—°λ Ήμ— μƒκ΄€μ—†μ΄ μ΅΄μ¤‘ν•λ” νƒλ„λ΅ μ†ν†µν•λ‹¤.",
    "[μ¦‰κ°μ  λ³΄κ³ ] λ¬Έμ  λ°μƒ μ‹ μ¨κΈ°μ§€ μ•κ³  μ¦‰μ‹ μƒκΈ‰μμ—κ² κ³µμ ν•λ‹¤.",
    "[κ΄€ν–‰ νƒ€ν] λ¶ν•„μ”ν• μμ „μ΄λ‚ λ³΄μ—¬μ£ΌκΈ°μ‹ ν–‰μ‚¬λ¥Ό μ κ·Ήμ μΌλ΅ μ¤„μ΄κ³  μλ‹¤.",
    "[μ κ·Ή ν–‰μ •] κ·μ • ν•‘κ³„λ³΄λ‹¤ μ κ·Ήμ μΌλ΅ ν•΄κ²°μ±…μ„ μ°Ύλ” μ‹λ„λ¥Ό μ§€μ§€ν•λ‹¤.",
    "[λ¶€μ„ ν‘μ—…] λ¶€μ„ κ°„ κ²½κ³„λ¥Ό λ„μ–΄ μ μ—°ν•κ² ν‘λ ¥ν•λ‹¤.",
    "[μ—…λ¬΄ μ§‘μ¤‘] μ‹¤λ¬΄μκ°€ ν•µμ‹¬ ν–‰μ • μ—…λ¬΄μ— μ§‘μ¤‘ν•  μ μλ” ν™κ²½μ„ μ΅°μ„±ν•λ‹¤.",
    "[νμ λ¬Έν™”] νμκ°€ μ§§κ³  λ…ν™•ν• μ•κ±΄ μ¤‘μ‹¬μΌλ΅ μ΄μλλ‹¤.",
    "[λ¦¬λ”μ λ°©ν¨] μ™Έλ¶€ μ”κµ¬λ‚ λ―Όμ› λ°μƒ μ‹ λ¦¬λ”κ°€ μ‹¤λ¬΄μλ¥Ό λ³΄νΈν•κ³  μ±…μ„μ§„λ‹¤.",
    "[μ—…λ¬΄λ‰ μ΅°μ¨] νΉμ • μ§μ›μ—κ² μ—…λ¬΄κ°€ λ°λ¦¬μ§€ μ•λ„λ΅ ν•©λ¦¬μ μΌλ΅ λ°°λ¶„ν•λ‹¤.",
    "[λ§¥λ½ κ³µμ ] λ¦¬λ”λ” μ—…λ¬΄ μ§€μ‹ μ‹ λ°°κ²½κ³Ό λ©μ μ„ λ‚©λ“ν•λ„λ΅ μ„¤λ…ν•λ‹¤.",
    "[μμ¨μ„± λ¶€μ—¬] μ‚¬μ†ν• κ°„μ„­μ„ μ§€μ–‘ν•κ³  μ‹¤λ¬΄μμ μ¬λ‰μ„ λ¶€μ—¬ν•λ‹¤.",
    "[μ„±μ¥ ν”Όλ“λ°±] μ§μ±…λ³΄λ‹¤ λ‹¤μλ²μ— λ” μν•  μ μλ„λ΅ κµ¬μ²΄μ μΌλ΅ μ΅°μ–Έν•λ‹¤.",
    "[μΌμƒμ  μΈμ •] λ™λ£λ¥Ό λ„μ™€μ¤€ μ§μ›μ„ μΌμƒμ μΌλ΅ μ•μ•„μ£Όκ³  μΉ­μ°¬ν•λ‹¤.",
    "[μ‹¤λ¬΄μ  νκ³ ] ν° μΌμ΄ λλ‚ ν›„ κΈ°λ΅ν•κ³  ν•™μµν•λ” λ¬Έν™”κ°€ μλ‹¤.",
    "[μ›λΌλ°Έ μ΅΄μ¤‘] ν΄κ°€ μ‚¬μ© μ‹ λμΉλ¥Ό μ£Όμ§€ μ•μΌλ©° μ‚¬μƒν™μ„ μ΅΄μ¤‘ν•λ‹¤.",
    "[μ„±μ¥ λ°°λ ¤] μ§λ¬΄ μ „λ¬Έμ„±μ„ μ“κΈ° μ„ν• κµμ΅ μ°Έμ—¬λ¥Ό λ°°λ ¤ν•λ‹¤.",
    "[λ…Έν•μ° κ³µμ ] μ—…λ¬΄ λ…Έν•μ°μ™€ μ„±κ³µ μ‚¬λ΅€λ¥Ό ν¬λ…ν•κ² κ³µμ ν•λ‹¤."
]

# λ¬Έν•­ μ…λ ¥ (4κ° μμ—­μΌλ΅ κµ¬λ¶„)
st.header("π“‹ μκ°€ μ§„λ‹¨ (1~7μ )")
scores = []
cols = st.columns(2)

for i, q in enumerate(questions):
    with cols[i % 2]:
        score = st.select_slider(f"Q{i+1}. {q}", options=range(1, 8), value=4)
        scores.append(score)

# 4. κ²°κ³Ό κ³„μ‚° λ° μ°¨νΈ
if st.button("β¨ κ²°κ³Ό ν™•μΈ λ° AI μ‹¬μΈµ μ§„λ‹¨ μ‹μ‘"):
    # μμ—­λ³„ ν‰κ·  κ³„μ‚°
    avg_scores = [
        sum(scores[0:5]) / 5,   # μ‹¬λ¦¬μ  μ•μ „κ°
        sum(scores[5:10]) / 5,  # ν–‰μ • ν¨μ¨μ„±
        sum(scores[10:15]) / 5, # λ¦¬λ”μ‹­
        sum(scores[15:20]) / 5  # μ •μ„μ  μΈμ •
    ]
    categories = ['μ‹¬λ¦¬μ  μ•μ „κ°', 'ν–‰μ • ν¨μ¨μ„±', 'λ¦¬λ”μ‹­', 'μ •μ„μ  μΈμ •']

    # λ μ΄λ” μ°¨νΈ κ·Έλ¦¬κΈ°
    fig = go.Figure()
    fig.add_trace(go.Scatterpolar(
        r=avg_scores + [avg_scores[0]],
        theta=categories + [categories[0]],
        fill='toself',
        line_color='#5d5fef'
    ))
    fig.update_layout(polar=dict(radialaxis=dict(visible=True, range=[1, 7])), showlegend=False)
    
    col_chart, col_result = st.columns([1, 1])
    
    with col_chart:
        st.subheader("π“ μ‹¤μ‹κ°„ μ΅°μ§ μ—­λ‰ λ¶„μ„")
        st.plotly_chart(fig, use_container_width=True)

    with col_result:
        with st.spinner("μ „λ¬Έκ°€ AIκ°€ λ¶„μ„ λ¦¬ν¬νΈλ¥Ό μ‘μ„± μ¤‘μ…λ‹λ‹¤..."):
            # AIμ—κ² λ°μ΄ν„° μ „λ‹¬
            input_text = f"ν€λ…: {team_name}\nμƒμ„Έ μ μ: {avg_scores}\nκ°λ³„ λ¬Έν•­ μ μ: {scores}"
            response = client.models.generate_content(
                model="gemini-2.0-flash",
                config={'system_instruction': SYSTEM_PROMPT},
                contents=input_text
            )
            st.subheader(f"π’΅ {team_name} λ§μ¶¤ν• μ§„λ‹¨ μ΄ν‰")
            st.write(response.text)